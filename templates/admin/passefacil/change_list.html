{% extends "admin/change_list.html" %}
{% load i18n admin_urls static admin_list %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
    .dashboard-stats {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    .stat-card {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .stat-card h3 {
        margin: 0 0 10px 0;
        color: #666;
        font-size: 1rem;
    }
    .stat-card p {
        margin: 0;
        font-size: 2rem;
        font-weight: bold;
    }
    .badge {
        font-size: 0.9em;
        padding: 0.35em 0.65em;
    }
    .badge.bg-success { background-color: #28a745 !important; }
    .badge.bg-danger { background-color: #dc3545 !important; }
    .badge.bg-secondary { background-color: #6c757d !important; }
    .button {
        padding: 2px 8px;
        margin: 0 2px;
        border-radius: 3px;
        background: #f0f0f0;
    }
    .button:hover {
        background: #e0e0e0;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Estatísticas -->
    <div class="dashboard-stats">
        <div class="stat-card">
            <h3>Total de Passes</h3>
            <p>{{ total_passes }}</p>
        </div>
        <div class="stat-card">
            <h3>Passes Ativos</h3>
            <p class="text-success">{{ passes_ativos }}</p>
        </div>
        <div class="stat-card">
            <h3>Passes Inativos</h3>
            <p class="text-danger">{{ passes_inativos }}</p>
        </div>
        <div class="stat-card">
            <h3>Validações Hoje</h3>
            <p>{{ total_validacoes_hoje }}</p>
        </div>
    </div>

    <!-- Botão de validação QR Code -->
    <div class="mb-4">
        <a href="{% url 'admin:passefacil_validar_qr_code' %}" class="button">
            <i class="fas fa-qrcode"></i> Validar QR Code
        </a>
    </div>

    <!-- Lista de Passe Fácil -->
    <div class="module">
        {{ block.super }}
    </div>

    <!-- Últimas Validações -->
    <div class="module">
        <h2>Últimas Validações</h2>
        <div class="results">
            <table>
                <thead>
                    <tr>
                        <th>Usuário</th>
                        <th>Código</th>
                        <th>Status</th>
                        <th>Data/Hora</th>
                        <th>IP</th>
                    </tr>
                </thead>
                <tbody>
                    {% for validacao in ultimas_validacoes %}
                    <tr>
                        <td>{% if validacao.passe_facil and validacao.passe_facil.user %}
                            {{ validacao.passe_facil.user.get_full_name|default:validacao.passe_facil.user.username }}
                            {% else %}
                            Usuário não encontrado
                            {% endif %}
                        </td>
                        <td><code>{{ validacao.codigo|default:'N/A' }}</code></td>
                        <td>
                            {% if validacao.valido %}
                            <span class="badge bg-success">Válido</span>
                            {% else %}
                            <span class="badge bg-danger">Inválido</span>
                            {% endif %}
                        </td>
                        <td>{{ validacao.data_validacao|date:"d/m/Y H:i" }}</td>
                        <td>{{ validacao.ip_address|default:'N/A' }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center">Nenhuma validação encontrada.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
