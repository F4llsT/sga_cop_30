{% extends 'base.html' %}
{% load static %}

{% block title %}Detalhes do Evento{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/detalhes_evento.css' %}">

<div class="event-detail-container">
    <div class="event-header">
        <h1 class="event-title">{{ evento.titulo }}</h1>
        <p class="event-time">
            {% if evento.start_time %}
                {{ evento.start_time|date:"d/m/Y H:i" }}
                {% if evento.end_time %}
                    - {{ evento.end_time|date:"H:i" }}
                {% else %}
                    - {{ evento.horario }}
                {% endif %}
            {% else %}
                {{ evento.horario }}
            {% endif %}
        </p>
    </div>

    <div class="event-body">
        <div class="event-description">
            <h2>Sobre o Evento</h2>
            <p>{{ evento.descricao|linebreaks }}</p>
        </div>

        <div class="event-location">
            <h2>Especificações</h2>
            <p><strong>Local:</strong> {{ evento.local }}</p>
            <p><strong>Palestrantes:</strong> {{ evento.palestrantes }}</p>
             {% if evento.latitude and evento.longitude %}
                <div id="map" style="height: 300px; width: 100%; border-radius: 8px; margin-top: 15px;"></div>
            {% else %}
                <div class="map-placeholder">
                    <p>Localização não fornecida.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <div class="event-actions">
        <a href="{% url 'agenda:add_to_agenda' evento.id %}" class="favorite-btn {% if is_favorited %}favorited{% endif %}">
            <span class="icon">★</span>
            <span class="text">
                {% if is_favorited %}
                    Agendado
                {% else %}
                    Adicionar à Agenda
                {% endif %}
            </span>
        </a>
    </div>
</div>

{% endblock %}


{% block extra_js %}
    {% if evento.latitude and evento.longitude %}
    <script>
        function initMap() {
            const evento_mapa = JSON.parse('{{ evento_mapa_json|escapejs }}');
            
            const localEvento = { lat: evento_mapa.latitude, lng: evento_mapa.longitude };

            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 16,
                center: localEvento,
                disableDefaultUI: true, // Opcional: remove controles do mapa para um visual mais limpo
            });

            const marker = new google.maps.Marker({
                position: localEvento,
                map: map,
                title: evento_mapa.titulo,
            });
        }
    </script>

    <script async
        src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap">
    </script>
    {% endif %}
{% endblock extra_js %}

